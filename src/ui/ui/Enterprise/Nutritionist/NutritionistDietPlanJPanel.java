/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */
package ui.Enterprise.Nutritionist;

import Business.Business.EcoSystem;
import Business.Organization.Organization;
import Business.Student.Student;
import Business.UserAccount.UserAccount;
import java.util.Map;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JSplitPane;

/**
 *
 * @author bbpri
 */
public class NutritionistDietPlanJPanel extends javax.swing.JPanel {

    private JSplitPane splitPane;
    private UserAccount sender;
    private Organization organization;
    private EcoSystem system;
    Student selectedStudent;
    String mealPlan;

    /**
     * Creates new form NutritionistDietPlanJPanel
     */
    public NutritionistDietPlanJPanel(JSplitPane splitPane, UserAccount account, Organization organization, EcoSystem system) {
        initComponents();
        this.splitPane = splitPane;
        this.sender = account;
        this.organization = organization;
        System.out.println("*NutritionistChat parent workarea j panel constructure " + organization);
        this.system = system;
        initComponents();
        populateStudentComboBox();
    }
    
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        btnback1 = new javax.swing.JButton();
        jLabel2 = new javax.swing.JLabel();
        cmbStudents = new javax.swing.JComboBox();
        jLabel1 = new javax.swing.JLabel();
        lblEmail3 = new javax.swing.JLabel();
        lblEmail2 = new javax.swing.JLabel();
        lblheight = new javax.swing.JLabel();
        lblweight = new javax.swing.JLabel();
        bntBmi = new javax.swing.JButton();
        lblEmail5 = new javax.swing.JLabel();
        lblEmail6 = new javax.swing.JLabel();
        lblgender = new javax.swing.JLabel();
        lblage = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jScrollPane2 = new javax.swing.JScrollPane();
        txtmeal = new javax.swing.JTextArea();
        lblbmi = new javax.swing.JLabel();

        setBackground(new java.awt.Color(204, 204, 255));

        btnback1.setText("Back");
        btnback1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnback1ActionPerformed(evt);
            }
        });

        jLabel2.setFont(new java.awt.Font("Times New Roman", 3, 24)); // NOI18N
        jLabel2.setText("Mean Plan suggestion");

        cmbStudents.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        cmbStudents.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmbStudentsActionPerformed(evt);
            }
        });

        jLabel1.setText("Select Student ");

        lblEmail3.setText("Weight in kgs");

        lblEmail2.setText("Height in meters");

        lblheight.setText("<Height>");

        lblweight.setText("<Weight>");

        bntBmi.setText("Calculate BMI");
        bntBmi.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                bntBmiActionPerformed(evt);
            }
        });

        lblEmail5.setText("Age");

        lblEmail6.setText("Gender");

        lblgender.setText("<Gender>");

        lblage.setText("<Age>");

        jLabel4.setText("Meal plan Suggestion");

        txtmeal.setEditable(false);
        txtmeal.setColumns(20);
        txtmeal.setRows(5);
        jScrollPane2.setViewportView(txtmeal);

        lblbmi.setText("<BMI>");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(41, 41, 41)
                        .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 97, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(cmbStudents, javax.swing.GroupLayout.PREFERRED_SIZE, 133, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addGap(158, 158, 158)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(bntBmi)
                                    .addComponent(lblbmi, javax.swing.GroupLayout.PREFERRED_SIZE, 266, javax.swing.GroupLayout.PREFERRED_SIZE)))
                            .addGroup(layout.createSequentialGroup()
                                .addGap(35, 35, 35)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(lblEmail3, javax.swing.GroupLayout.PREFERRED_SIZE, 88, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(lblEmail2))
                                .addGap(35, 35, 35)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(lblweight, javax.swing.GroupLayout.PREFERRED_SIZE, 86, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(lblheight, javax.swing.GroupLayout.PREFERRED_SIZE, 86, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(lblEmail5, javax.swing.GroupLayout.PREFERRED_SIZE, 62, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(lblEmail6, javax.swing.GroupLayout.PREFERRED_SIZE, 62, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addGap(35, 35, 35)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(lblgender, javax.swing.GroupLayout.PREFERRED_SIZE, 86, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(lblage, javax.swing.GroupLayout.PREFERRED_SIZE, 86, javax.swing.GroupLayout.PREFERRED_SIZE)))))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(29, 29, 29)
                        .addComponent(btnback1)
                        .addGap(55, 55, 55)
                        .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 266, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(87, 87, 87)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel4)
                            .addGroup(layout.createSequentialGroup()
                                .addGap(106, 106, 106)
                                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 585, javax.swing.GroupLayout.PREFERRED_SIZE)))))
                .addContainerGap(43, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(20, 20, 20)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnback1)
                    .addComponent(jLabel2))
                .addGap(33, 33, 33)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jLabel1)
                        .addComponent(cmbStudents, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(lblEmail2)
                            .addComponent(lblheight))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(lblEmail3)
                            .addComponent(lblweight)))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(lblEmail5)
                            .addComponent(lblage))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(lblEmail6)
                            .addComponent(lblgender))))
                .addGap(34, 34, 34)
                .addComponent(bntBmi)
                .addGap(12, 12, 12)
                .addComponent(lblbmi)
                .addGap(53, 53, 53)
                .addComponent(jLabel4)
                .addGap(12, 12, 12)
                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 159, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(261, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void btnback1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnback1ActionPerformed
        // TODO add your handling code here:
        NutritionistsWorkAreaJPanel nwajp = new NutritionistsWorkAreaJPanel(splitPane, sender, system, system);
        splitPane.setRightComponent(nwajp);
    }//GEN-LAST:event_btnback1ActionPerformed

    private void cmbStudentsActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmbStudentsActionPerformed
        // TODO add your handling code here:
        selectedStudent = (Student) cmbStudents.getSelectedItem();

        if (selectedStudent != null) {
            lblheight.setText(String.valueOf(selectedStudent.getHeight()));
            lblweight.setText(String.valueOf(selectedStudent.getWeight()));
            lblage.setText(String.valueOf(selectedStudent.getAge()));
            lblgender.setText(selectedStudent.getGender());
        }
    }//GEN-LAST:event_cmbStudentsActionPerformed

    private String interpretBMIForStudents(double bmi, String gender) {
        if (gender.equalsIgnoreCase("Female")) {
            if (bmi < 15.5) {
                return "Severely Underweight (Female)";
            } else if (bmi < 18) {
                return "Underweight (Female)";
            } else if (bmi < 24) {
                return "Normal weight (Female)";
            } else if (bmi < 29) {
                return "Overweight (Female)";
            } else {
                return "Obese (Female)";
            }
        } else { // Male thresholds
            if (bmi < 16) {
                return "Severely Underweight (Male)";
            } else if (bmi < 19) {
                return "Underweight (Male)";
            } else if (bmi < 25) {
                return "Normal weight (Male)";
            } else if (bmi < 30) {
                return "Overweight (Male)";
            } else {
                return "Obese (Male)";
            }
        }
    }

    private double calculateBMI(double weight, double height) {
        return weight / (height * height); // BMI formula: weight (kg) / height (m)^2
    }

    private String suggestMealPlanForStudents(String bmiCategory, String gender, Map<String, Map<String, String>> performances) {
        StringBuilder mealPlan = new StringBuilder();
    
        mealPlan.append("BMI Category: ").append(bmiCategory).append("\n");
        mealPlan.append("Gender: ").append(gender).append("\n\n");
    
        // BMI-based recommendations
        switch (bmiCategory) {
            case "Severely Underweight (Female)":
            case "Severely Underweight (Male)":
                mealPlan.append("Focus on high-calorie, protein-rich meals to support growth.\n");
                mealPlan.append("Add whole grains, lean meats, dairy, and healthy fats.\n");
                break;
    
            case "Underweight (Female)":
            case "Underweight (Male)":
                mealPlan.append("Increase calorie intake with nutrient-dense foods.\n");
                mealPlan.append("Add nuts, avocados, whole grains, and dairy.\n");
                break;
    
            case "Normal weight (Female)":
            case "Normal weight (Male)":
                mealPlan.append("Maintain a balanced diet with vegetables, fruits, proteins, and healthy fats.\n");
                break;
    
            case "Overweight (Female)":
            case "Overweight (Male)":
            case "Obese (Female)":
            case "Obese (Male)":
                mealPlan.append("Focus on high-fiber, low-calorie meals.\n");
                mealPlan.append("Limit processed foods and sugary drinks.\n");
                break;
    
            default:
                mealPlan.append("No specific recommendations.\n");
        }
    
        // Performance-based adjustments
        mealPlan.append("\nPerformance-Based Adjustments:\n");
        for (Map.Entry<String, Map<String, String>> entry : performances.entrySet()) {
            String game = entry.getKey();
            Map<String, String> metrics = entry.getValue();
    
            mealPlan.append("Game: ").append(game).append("\n");
    
            String endurance = metrics.getOrDefault("Endurance", "Average");
            String strength = metrics.getOrDefault("Strength", "Average");
            String mentalFocus = metrics.getOrDefault("MentalFocus", "Average");
            int performanceScore = Integer.parseInt(metrics.getOrDefault("performanceScore", "0"));
    
            if (endurance.equalsIgnoreCase("Excellent") || performanceScore > 8) {
                mealPlan.append("- Add carbohydrates for energy recovery.\n");
            }
            if (strength.equalsIgnoreCase("Excellent")) {
                mealPlan.append("- Include lean proteins like chicken, fish, eggs, and legumes.\n");
            }
            if (mentalFocus.equalsIgnoreCase("Poor") || mentalFocus.equalsIgnoreCase("Distracted")) {
                mealPlan.append("- Increase omega-3 intake and hydration.\n");
            }
        }
    
        return mealPlan.toString();
    }
    
    private void bntBmiActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_bntBmiActionPerformed
        // TODO add your handling code here:

        try {
            // Validate Age
            String ageText = lblage.getText().trim();
            if (ageText.isEmpty() || ageText.equals("<Age>")) {
                JOptionPane.showMessageDialog(this, "Please enter a valid age.", "Error", JOptionPane.ERROR_MESSAGE);
                return;
            }

            int age = Integer.parseInt(ageText);

            // Validate Height
            String heightText =  lblheight.getText().trim();
            if (heightText.isEmpty()) {
                JOptionPane.showMessageDialog(this, "Please enter a valid height in meters.", "Error", JOptionPane.ERROR_MESSAGE);
                return;
            }

            double height = Double.parseDouble(heightText);

            // Validate Weight
            String weightText = lblweight.getText().trim();
            if (weightText.isEmpty()) {
                JOptionPane.showMessageDialog(this, "Please enter a valid weight in kilograms.", "Error", JOptionPane.ERROR_MESSAGE);
                return;
            }

            double weight = Double.parseDouble(weightText);

            String gender = lblgender.getText();
            if (gender.isEmpty()) {
                JOptionPane.showMessageDialog(this, "Enter not fetched.", "Error", JOptionPane.ERROR_MESSAGE);
                return;
            }

            // Validate selected student
        if (selectedStudent == null) {
            JOptionPane.showMessageDialog(this, "Please select a valid student.", "Error", JOptionPane.ERROR_MESSAGE);
            return;
        }

        // Calculate BMI
        double bmi = calculateBMI(weight, height);
        String bmiCategory = interpretBMIForStudents(bmi, gender);

         // Analyze performance
         Map<String, Map<String, String>> performances = selectedStudent.getGamePerformances();

         // Suggest meal plan
         String mealPlan = suggestMealPlanForStudents(bmiCategory, gender, performances);
 
         // Display results
         lblbmi.setText(String.format("BMI: %.2f (%s)", bmi, bmiCategory));
         txtmeal.setText(mealPlan);

         // Store BMI and Meal Plan in Student object
        selectedStudent.setBmi(bmi);
        selectedStudent.setBmiCategory(bmiCategory);
        selectedStudent.setMealPlan(mealPlan);
         
        } catch (NumberFormatException e) {
            JOptionPane.showMessageDialog(this, "Please enter valid numeric values for age, height, and weight.", "Error", JOptionPane.ERROR_MESSAGE);
        } catch (Exception e) {
            JOptionPane.showMessageDialog(this, "An unexpected error occurred: " + e.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);
        }      
    }//GEN-LAST:event_bntBmiActionPerformed

    

    private void populateStudentComboBox() {
        cmbStudents.removeAllItems();
        Organization org = system.getOrganizationDirectory().findOrganization(Organization.Type.Student);
        org.getStudentDirectory().getStudentList();
        System.out.println("Student List is as follows ");
        for (Student s : org.getStudentDirectory().getStudentList()) {
            System.out.println(s);
            cmbStudents.addItem(s);
        }
    }

   
   
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton bntBmi;
    private javax.swing.JButton btnback1;
    private javax.swing.JComboBox cmbStudents;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JLabel lblEmail2;
    private javax.swing.JLabel lblEmail3;
    private javax.swing.JLabel lblEmail5;
    private javax.swing.JLabel lblEmail6;
    private javax.swing.JLabel lblage;
    private javax.swing.JLabel lblbmi;
    private javax.swing.JLabel lblgender;
    private javax.swing.JLabel lblheight;
    private javax.swing.JLabel lblweight;
    private javax.swing.JTextArea txtmeal;
    // End of variables declaration//GEN-END:variables
}
